NAT66機能について
==================================================================================================

実装の経緯
--------------------------------------------------------------------------------------------------

__まず最初に、この機能はNAT66を推進するものではありません。__NAT66が顕在化してきた環境に対して必要になったため、実装した機能になります。

というのも、IPv6におけるNATは存在するべきではないと長らくIETFで議論されてきてましたが、実際のゲームを遊ぶユーザの環境として一定数検知され、それが増加傾向にあると、近年の弊社のオンラインゲームタイトルのログ調査から判明しています。

既存の実装や今後のネットワーク実装における、NAT66環境下における動作検証の準備が求められ、この機能は実装されました。

NAT66に関する詳細は、CEDEC2024で行われた下記セッションにて解説していますので、そちらも併せて参照ください。

##### 参考講演

- [CEDEC2024 / IPv6向けNATの台頭と新たなNAT挙動を理解・対応実装を学び、変化するIPv6環境に備えよう！](https://cedil.cesa.or.jp/cedil_sessions/view/2928)

## NAT66を有効にする手順

配布イメージではデフォルトで無効になっています。

IPv6が利用可能な環境（適切にRAが降ってくる環境）に接続してIPv4 only モードで起動し、「Setting > IP/NAT > IPv6 Mode Setting」から 「Disable => NAT」に変更し、本体を再起動します。これで有効になります。

なお一度有効にしても、IPv6が無効な環境で起動すると強制的にIPv4 only モードにフォールバックするため、ご注意ください。

現在IPv6モードかどうかは「Setting > SYSTEM」に表示されるIP情報から確認可能です。IPv6 有効時には各種IP情報が下図のようにIPv4/IPv6で併記されます。（起動時の初期化画面で、IPv6 ENV CHECK の項目がOKになるかどうかでも判定できます。）

<img src="/System/Volumes/Data/share/EM-uNetPi5/docs/img/SampleIPv6Setting.jpg" alt="SampleIPv6Setting" style="zoom:33%;" />

> NAT、NAT/Symmetric の 2モードが存在しますが、いづれもNAT66モードになります。後者はNAPTのMapping挙動がいわゆるシンメトリック挙動になるという違いあります。

今後のIPv6まわりの機能改修について
--------------------------------------------------------------------------------------------------

- 各種IPv6モード

  - NPTv6 に関しては、今後の市場における動向を見た上で必要があると判断した場合、実装を検討する予定です。

  - Bridge / ND-Proxy に関しては、今後実装予定です。（時期未定）

- UPnP機能
  - 国内でIPv6向けのUPnPを検証する環境が構築しにくい問題を解決するため、IPv6向けUPnP機能を実装予定です。（時期未定）

